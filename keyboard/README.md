# Layout

The keyboard layout is based on the standard US (QWERTY) layout. Its named
`Programmer` on all systems.

# MacOS

Use `Ukelele` app to open the bundle.

# Linux

### Links

- [Intro XKB](linux/README-XKB.md)
- [Archwiki](https://wiki.archlinux.org/title/X_keyboard_extension)

## Check the current `xkb` settings

```shell
setxkbmap -print -verbose 10
```

List all settings

```shell
localectl list-x11-keymap-models
localectl list-x11-keymap-layouts
localectl list-x11-keymap-variants [layout]
localectl list-x11-keymap-options
```

## Check Key Codes

To see the key label corresponding to the `keycode` generated by a key use

```shell
xev -event keyboard
```

and press a key and grep inside `/usr/share/X11/xkb/keycodes` directory to find
the symbol of this key press.

## Creating a New Keyboard Layout

### Find Base `kbd_symbols` Layout

Navigate to `/usr/share/X11/xkb` and open `rules/evdev.xml`. Now, identify the
keyboard you want to base your layout on. You can search by the descriptions in
the GUI keyboard preferences. Within the `<layout>` tag, you'll find the base
layout under the `<configItem>` tag. Identify the two char code in the `<name>`
tag, most likely `us`.

We use here the layout `us` with a variant
`us/variantList/variant[name[text()='programmer']`.

Now, open `/usr/share/X11/xkb/symbols/us` and this is your base symbol layout.
There are other files you can edit too but you'll need to make more advanced
config changes, like `rules` and a `keymap`. In `symbols/us`, the first
`kbd_symbols` definition defines the basic symbol layout, imported by most of
the other `kbd_symbols` definitions. You'll notice that the others in this file
usually have `include "us(basic)`, which refer to the symbol filename and the
symbol definition name. We also use this in
[`us_programmer`](linux/us_programmer).

### Create a `kbd_symbols` File

Now, create a new symbols file with a new country code. I used `io`. Here's the
basic config I'm starting out with. With `include "us"`, i'm pulling in the
`us(basic)` config and then overriding that.

After you're done editing, copy your file to `/usr/share/X11/xkb/symbols/xx`.

```

partial alphanumeric_keys xkb_symbols "basic" {

    include "us"
    name[Group1]= "Digimon - US";

    // swap symbols and digits
    key <TLDE> { [     grave, asciitilde ] };
    key <AE01> { [     exclam,      1          ] };
    key <AE02> { [     at,          2  ] };
    key <AE03> { [     numbersign,  3 ] };
    key <AE04> { [     dollar,      4  ] };
    key <AE05> { [     percent,     5  ] };
    key <AE06> { [     asciicircum, 6 ] };
    key <AE07> { [     ampersand,   7 ] };
    key <AE08> { [     asterisk,    8 ] };
    key <AE09> { [     parenleft,   9 ] };
    key <AE10> { [     parenright,  0 ] };
    key <AE11> { [     minus, underscore ] };
    key <AE12> { [     equal, plus  ] };

};

```

### Swapping `CTRL` with `Caps-Lock`

Swapping Caps Lock with Left Control To swap Caps Lock with Left Control key,
add `ctrl:swapcaps` to XkbOptions. Run the following command to see similar
options along with their descriptions:

```shell
grep -E "(ctrl|caps):" /usr/share/X11/xkb/rules/base.lst
```

### Update `evdev.xml` to include the new layout

You'll need to update `evdev.xml` to include the new layout and any variants you
want included.

```xml
  </modelList>
  <layoutList>

<!-- add the new layout here -->

    <layout>
      <configItem>
        <name>io</name>

        <shortDescription>en</shortDescription>
        <description>Digimon (US)</description>
        <languageList>
          <iso639Id>eng</iso639Id>
        </languageList>
      </configItem>

      <!-- add any variant lists here -->

    </layout>

<!-- US layout and variants start here-->

    <layout>
      <configItem>
        <name>us</name>

```

### Load Your Changes

Some distros will pick up the changes and insert them in the keyboard
preferences as soon as I saved the file. If your changes aren't showing up, try
reordering your keyboard layouts in keyboard preferences or deleting & readding
the new one.

#### Reconfigure `xkb-data` (Ubuntu only?)

[This article](https://help.ubuntu.com/community/Custom%20keyboard%20layout%20definition)
says this may be running `sudo dpkg-reconfigure xkb-data` may be required. This
is so that Ubuntu reconfigures the changes made to your `/usr/share/X11/xkb`
folder.
